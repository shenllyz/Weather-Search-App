<!DOCTYPE html>
<html>
<head>
  <title>Autocomplete Demo</title>
  <style>
    /* Basic styles for the dropdown */
    .dropdown {
      position: relative;
      display: inline-block;
    }

    .dropdown-content {
      position: absolute;
      background-color: #f9f9f9;
      min-width: 200px;
      max-height: 150px;
      overflow-y: auto;
      border: 1px solid #ccc;
      z-index: 1;
    }

    .dropdown-content div {
      padding: 8px 12px;
      cursor: pointer;
    }

    .dropdown-content div:hover {
      background-color: #f1f1f1;
    }
  </style>
</head>
<body>
  <h1>City Autocomplete Demo</h1>
  <div>
    <label for="city-input">City: </label>
    <input type="text" id="city-input" autocomplete="off" />
    <div class="dropdown" id="autocomplete-dropdown"></div>
  </div>
  <div>
    <label for="state-input">State: </label>
    <input type="text" id="state-input" readonly />
  </div>

  <script>
    const cityInput = document.getElementById('city-input');
    const stateInput = document.getElementById('state-input');
    const dropdown = document.getElementById('autocomplete-dropdown');
  
    cityInput.addEventListener('input', async () => {
      const inputValue = cityInput.value.trim();
      if (inputValue.length === 0) {
        dropdown.innerHTML = '';
        return;
      }
  
      try {
        const response = await fetch(`/autocomplete?input=${encodeURIComponent(inputValue)}`);
        if (response.ok) {
          const results = await response.json();
  
          // Clear previous results
          dropdown.innerHTML = '';
          dropdown.style.display = 'none';
  
          if (results.length > 0) {
            dropdown.style.display = 'block';
  
            results.forEach(({ city, state }) => {
              const item = document.createElement('div');
              item.textContent = city;
              item.addEventListener('click', () => {
                cityInput.value = city;
                stateInput.value = state;
                dropdown.innerHTML = '';
                dropdown.style.display = 'none';
              });
              dropdown.appendChild(item);
            });
          }
        } else {
          console.error('Error fetching autocomplete results:', response.statusText);
        }
      } catch (error) {
        console.error('Error fetching autocomplete results:', error);
      }
    });
  
    // Hide dropdown when clicking outside
    document.addEventListener('click', (event) => {
      if (!event.target.matches('#city-input')) {
        dropdown.innerHTML = '';
        dropdown.style.display = 'none';
      }
    });
  </script>
</body>
</html>